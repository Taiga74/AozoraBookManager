<div class="container mt-4">
  <h1 class="mb-3"><%= @book.title %></h1>
  <p><strong>著者:</strong> <%= @book.author %></p>
  <p><strong>発行日:</strong> <%= @book.publication_date %></p>
  <p><strong>文字数:</strong> <%= @book.word_count %>字</p>
  <p><strong>カテゴリ:</strong> <%= @book.category %></p>
  <p><%= link_to '作品を読む', @book.url, class: "btn btn-primary" %></p>

  <% if user_signed_in? %>
    <div class="mt-3">
      <% if current_user.favorite_books.include?(@book) %>
        <%= button_to 'お気に入りから削除', favorite_book_path(@book), method: :delete, class: "btn btn-danger" %>
      <% else %>
        <%= button_to 'お気に入り追加', favorite_book_path(@book), method: :post, class: "btn btn-success me-2" %>
      <% end %>

      <% if current_user.bookmarked_books.include?(@book) %>
        <%= button_to '後で見るから削除', bookmark_book_path(@book), method: :delete, class: "btn btn-danger" %>
      <% else %>
        <%= button_to '後で見る', bookmark_book_path(@book), method: :post, class: "btn btn-success" %>
      <% end %>
    </div>
  <% end %>

  <h2 class="mt-4">評価・コメント</h2>
  <% if @book.reviews.any? %>
    <% @book.reviews.each do |review| %>
      <div class="card mb-3">
        <div class="card-body">
          <strong>評価:</strong> <%= review.rating %> / 5<br>
          <strong>コメント:</strong> <%= review.comment %><br>
          <strong>ユーザー:</strong> <%= review.user.email %>
        </div>
      </div>
    <% end %>
  <% else %>
    <p>この作品についてのコメントはありません。</p>
  <% end %>

  <% if user_signed_in? %>
    <h4>評価・コメントを投稿する</h4>
    <%= form_with model: [@book, @book.reviews.new], url: review_book_path(@book), local: true do |form| %>
      <div class="mb-3">
        <%= form.label :評価, class: "form-label" %>
        <%= form.number_field :rating, in: 1..5, class: "form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :コメント, class: "form-label" %>
        <%= form.text_area :comment, class: "form-control" %>
      </div>
      <div>
        <%= form.submit '投稿', class: "btn btn-primary" %>
      </div>
    <% end %>
  <% else %>
    <p>You need to <%= link_to 'sign in', new_user_session_path %> to add a review.</p>
  <% end %>
</div>
